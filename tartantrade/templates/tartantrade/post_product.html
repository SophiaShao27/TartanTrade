{% extends 'tartantrade/base.html' %}
{% load static %}

{% block title %}Post a Product - TartanTrade{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'tartantrade/item-styles.css' %}">
<link rel="stylesheet" href="{% static 'tartantrade/post-product.css' %}">
{% endblock %}

{% block content %}
<div class="container">
  <div class="form-container">
    <h1 class="form-title">Post a Product</h1>

    {% if form.errors %}
    <div class="alert alert-danger">
      <p>Please correct the errors below:</p>
      <ul>
        {% for field in form %}
          {% for error in field.errors %}
            <li>{{ field.label }}: {{ error }}</li>
          {% endfor %}
        {% endfor %}
        {% for error in form.non_field_errors %}
          <li>{{ error }}</li>
        {% endfor %}
      </ul>
    </div>
    {% endif %}

    <form method="post" enctype="multipart/form-data" id="product-form">
      {% csrf_token %}

      <!-- Title -->
      <div class="form-group">
        <label for="id_title">Title</label>
        <input type="text" name="title" id="id_title" class="form-control"
               value="{{ form.title.value|default:'' }}" required>
        {% if form.title.errors %}
        <div class="error-message">{{ form.title.errors }}</div>
        {% endif %}
      </div>

      <!-- Price -->
      <div class="form-group">
        <label for="id_price">Price ($)</label>
        <input type="number" name="price" id="id_price" class="form-control"
               value="{{ form.price.value|default:'' }}" min="0.01" step="0.01" required>
        {% if form.price.errors %}
        <div class="error-message">{{ form.price.errors }}</div>
        {% endif %}
        <div class="help-text">Enter sale or buy-now price.</div>
      </div>

      <!-- Description -->
      <div class="form-group">
        <label for="id_description">Description</label>
        <textarea name="description" id="id_description" class="form-control"
                  rows="5" required>{{ form.description.value|default:'' }}</textarea>
        {% if form.description.errors %}
        <div class="error-message">{{ form.description.errors }}</div>
        {% endif %}
      </div>

      <!-- Category -->
      <div class="form-group">
        <label for="id_categories">Category</label>
        <select name="categories" id="id_categories" class="form-control">
          <option value="Electronics" {% if form.categories.value == "Electronics" %}selected{% endif %}>Electronics</option>
          <option value="Books" {% if form.categories.value == "Books" %}selected{% endif %}>Books</option>
          <option value="Furniture" {% if form.categories.value == "Furniture" %}selected{% endif %}>Furniture</option>
          <option value="Clothing" {% if form.categories.value == "Clothing" %}selected{% endif %}>Clothing</option>
          <option value="Sports" {% if form.categories.value == "Sports" %}selected{% endif %}>Sports</option>
          <option value="Other" {% if form.categories.value == "Other" %}selected{% endif %}>Other</option>
        </select>
        {% if form.categories.errors %}
        <div class="error-message">{{ form.categories.errors }}</div>
        {% endif %}
      </div>

      <!-- Condition -->
      <div class="form-group">
        <label for="id_condition">Condition</label>
        <select name="condition" id="id_condition" class="form-control">
          <option value="New" {% if form.condition.value == "New" %}selected{% endif %}>New</option>
          <option value="Like New" {% if form.condition.value == "Like New" %}selected{% endif %}>Like New</option>
          <option value="Good" {% if form.condition.value == "Good" %}selected{% endif %}>Good</option>
          <option value="Fair" {% if form.condition.value == "Fair" %}selected{% endif %}>Fair</option>
          <option value="Poor" {% if form.condition.value == "Poor" %}selected{% endif %}>Poor</option>
        </select>
        {% if form.condition.errors %}
        <div class="error-message">{{ form.condition.errors }}</div>
        {% endif %}
      </div>

      <!-- Pickup location -->
      <div class="form-group">
        <label for="id_pickup_location">Pickup Location</label>
        <input type="text" name="pickup_location" id="id_pickup_location" class="form-control"
               value="{{ form.pickup_location.value|default:'' }}" required>
        {% if form.pickup_location.errors %}
        <div class="error-message">{{ form.pickup_location.errors }}</div>
        {% endif %}
      </div>

      <!-- Picture -->
      <div class="form-group">
        <label>Product Image</label>
        <input type="file" name="picture" id="id_picture" class="form-control" accept="image/*">
        {% if form.picture.errors %}
        <div class="error-message">{{ form.picture.errors }}</div>
        {% endif %}
      </div>

      <!-- Auction Toggle -->
      <div class="toggle-container">
        <span class="toggle-label">Post as Auction</span>
        <label class="toggle-switch">
          <input type="checkbox" id="auction-toggle" name="is_auction">
          <span class="toggle-slider"></span>
        </label>
      </div>

      <!-- Auction Fields -->
      <div class="auction-options" id="auction-options">
        <div class="form-group">
          <label for="id_start_price">Starting Price ($)</label>
          <input type="number" name="start_price" id="id_start_price" class="form-control"
                 value="{{ form.start_price.value|default:'' }}" min="0.01" step="0.01">
        </div>
        <div class="form-group">
          <label for="id_end_time">Auction End Time</label>
          <input type="datetime-local" name="end_time" id="id_end_time" class="form-control"
                 value="{{ form.end_time.value|default:'' }}">
        </div>
      </div>

      <button type="submit" class="btn btn-submit">Post Product</button>
    </form>
  </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'tartantrade/post-product.js' %}"></script>
{% endblock %}
